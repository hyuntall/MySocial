{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/gc159/Desktop/nwitter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/gc159/Desktop/nwitter/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\gc159\\\\Desktop\\\\nwitter\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useRef}from\"react\";import{storageService,dbService}from\"myFirebase\";import{addDoc,collection}from\"firebase/firestore\";import{getDownloadURL,ref,uploadString}from\"firebase/storage\";import{v4}from\"uuid\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faPlus,faTimes}from\"@fortawesome/free-solid-svg-icons\";import'post.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PostFactory=function PostFactory(_ref){var userObj=_ref.userObj;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),post=_useState2[0],setPost=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),attachment=_useState4[0],setAttachment=_useState4[1];var fileInput=useRef();var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var attachmentURL,attachmentRef,uploadFile,docRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(post===\"\")){_context.next=2;break;}return _context.abrupt(\"return\");case 2:event.preventDefault();_context.prev=3;attachmentURL=\"\";if(!(attachment!==\"\")){_context.next=14;break;}// 이미지 첨부 했을 경우\n// 파일 경로 참조 생성\nattachmentRef=ref(storageService,\"\".concat(userObj.uid,\"/\").concat(v4()));//v4: 랜덤숫자\n// storage 참조 경로로 파일 업로드\n_context.next=9;return uploadString(attachmentRef,attachment,\"data_url\");case 9:uploadFile=_context.sent;_context.next=12;return getDownloadURL(uploadFile.ref);case 12:attachmentURL=_context.sent;console.log(attachmentURL);case 14:_context.next=16;return addDoc(// 작성한 게시글 db에 업로드\ncollection(dbService,\"posts\"),{text:post,createdAt:Date.now(),creatorId:userObj.uid,creatorName:userObj.displayName,userProfileImg:userObj.photoURL,attachmentURL:attachmentURL});case 16:docRef=_context.sent;setPost(\"\");onClearAttachmentClick();_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](3);console.error(\"Error adding document: \",_context.t0);case 24:case\"end\":return _context.stop();}}},_callee,null,[[3,21]]);}));return function onSubmit(_x){return _ref2.apply(this,arguments);};}();var onChange=function onChange(event){var value=event.target.value;setPost(value);};var onFileChange=function onFileChange(event){// 이미지 입력 시 url을 읽는 함수\nvar files=event.target.files;var theFile=files[0];var reader=new FileReader();reader.onloadend=function(finishEvent){var result=finishEvent.currentTarget.result;setAttachment(result);};reader.readAsDataURL(theFile);};var onClearAttachmentClick=function onClearAttachmentClick(){setAttachment(\"\");fileInput.current.value=\"\";};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,className:\"factoryForm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"factoryInput__container\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"FactoryInput_input\",value:post,onChange:onChange,type:\"text\",placeholder:\"What's on your mind?\",maxLength:120}),/*#__PURE__*/_jsx(\"input\",{className:\"factoryInput__arrow\",type:\"submit\",value:\"posting\"})]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"attach-file\",className:\"factoryInput_label\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Add photos\"}),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faPlus})]}),/*#__PURE__*/_jsx(\"input\",{id:\"attach-file\",style:{opacity:0}// 이미지파일 첨부 버튼\n,type:\"file\",accept:\"image/*\",onChange:onFileChange,ref:fileInput}),attachment&&/*#__PURE__*/ // 첨부한 이미지가 있을 경우 이미지 표시\n_jsxs(\"div\",{className:\"factoryForm__attachment\",children:[/*#__PURE__*/_jsx(\"img\",{src:attachment,style:{backgroundImage:attachment}}),/*#__PURE__*/_jsxs(\"div\",{className:\"factoryForm__clear\",onClick:onClearAttachmentClick,children:[/*#__PURE__*/_jsx(\"span\",{children:\"Remove\"}),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTimes})]})]})]});};export default PostFactory;","map":{"version":3,"sources":["C:/Users/gc159/Desktop/nwitter/src/components/PostFactory.js"],"names":["React","useState","useRef","storageService","dbService","addDoc","collection","getDownloadURL","ref","uploadString","v4","FontAwesomeIcon","faPlus","faTimes","PostFactory","userObj","post","setPost","attachment","setAttachment","fileInput","onSubmit","event","preventDefault","attachmentURL","attachmentRef","uid","uploadFile","console","log","text","createdAt","Date","now","creatorId","creatorName","displayName","userProfileImg","photoURL","docRef","onClearAttachmentClick","error","onChange","value","target","onFileChange","files","theFile","reader","FileReader","onloadend","finishEvent","result","currentTarget","readAsDataURL","current","opacity","backgroundImage"],"mappings":"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","sourcesContent":["import React, { useState, useRef } from \"react\";\r\nimport { storageService, dbService } from \"myFirebase\";\r\nimport { addDoc, collection } from \"firebase/firestore\";\r\nimport { getDownloadURL, ref, uploadString } from \"firebase/storage\"\r\nimport {v4} from \"uuid\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faPlus, faTimes } from \"@fortawesome/free-solid-svg-icons\";\r\nimport 'post.css'\r\nconst PostFactory = ({ userObj }) => {\r\n    const [post, setPost] = useState(\"\");\r\n    const [attachment, setAttachment] = useState(\"\");\r\n    const fileInput = useRef();\r\n    const onSubmit = async (event) => {\r\n        // 작성한 게시글 업로드하는 함수\r\n        if (post === \"\") {\r\n            // 작성한 글이 없으면 return\r\n            return;\r\n        }\r\n        event.preventDefault();\r\n        \r\n        try {\r\n            let attachmentURL = \"\";\r\n            if(attachment !== \"\"){\r\n                // 이미지 첨부 했을 경우\r\n                // 파일 경로 참조 생성\r\n                const attachmentRef = ref(storageService, `${userObj.uid}/${v4()}`);//v4: 랜덤숫자\r\n                // storage 참조 경로로 파일 업로드\r\n                const uploadFile = await uploadString(attachmentRef, attachment, \"data_url\");\r\n                // storage에 있는 파일 URL로 다운\r\n                attachmentURL = await getDownloadURL(uploadFile.ref)\r\n                console.log(attachmentURL);\r\n            }\r\n            const docRef = await addDoc(\r\n                // 작성한 게시글 db에 업로드\r\n                collection(\r\n                    dbService, \"posts\"), {\r\n                    text: post,\r\n                    createdAt: Date.now(),\r\n                    creatorId: userObj.uid,\r\n                    creatorName: userObj.displayName,\r\n                    userProfileImg: userObj.photoURL,\r\n                    attachmentURL\r\n            });\r\n            setPost(\"\");\r\n            onClearAttachmentClick();\r\n        } catch (error) {\r\n            console.error(\"Error adding document: \", error);\r\n        }\r\n    };\r\n    const onChange = (event) => {\r\n        const { target:{value} } = event;\r\n        setPost(value);\r\n    }\r\n    const onFileChange = (event) => {\r\n        // 이미지 입력 시 url을 읽는 함수\r\n        const {target:{files}} = event;\r\n        const theFile = files[0];\r\n        const reader = new FileReader();\r\n        reader.onloadend = (finishEvent) => {\r\n            const {currentTarget: { result }} = finishEvent\r\n            setAttachment(result)\r\n        }\r\n        reader.readAsDataURL(theFile);\r\n    }\r\n    const onClearAttachmentClick = () => {\r\n        setAttachment(\"\")\r\n        fileInput.current.value = \"\";\r\n    };\r\n\r\n    return (\r\n        <form onSubmit={onSubmit} className=\"factoryForm\">\r\n            <div className=\"factoryInput__container\">\r\n                <input className=\"FactoryInput_input\"\r\n                value={post} onChange={onChange} \r\n                type=\"text\" placeholder=\"What's on your mind?\" maxLength={120}/>\r\n                <input className=\"factoryInput__arrow\"\r\n                type=\"submit\" value=\"posting\" />\r\n            </div>\r\n\r\n            <label htmlFor=\"attach-file\" className=\"factoryInput_label\">\r\n                <span>Add photos</span>\r\n                <FontAwesomeIcon icon={faPlus} />\r\n            </label>\r\n            <input id=\"attach-file\" style={{opacity: 0}} // 이미지파일 첨부 버튼\r\n            type=\"file\" accept=\"image/*\" onChange={onFileChange} ref={fileInput}/>\r\n            \r\n            {attachment && ( // 첨부한 이미지가 있을 경우 이미지 표시\r\n                <div className=\"factoryForm__attachment\">\r\n                    <img src={attachment} style={{backgroundImage:attachment}} />\r\n                    <div className=\"factoryForm__clear\" onClick={onClearAttachmentClick}>\r\n                        <span>Remove</span>\r\n                        <FontAwesomeIcon icon={faTimes} />\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </form>\r\n    )\r\n}\r\nexport default PostFactory"]},"metadata":{},"sourceType":"module"}