{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/gc159/Desktop/nwitter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/gc159/Desktop/nwitter/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\gc159\\\\Desktop\\\\nwitter\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useRef}from\"react\";import{storageService,dbService}from\"myFirebase\";import{addDoc,collection}from\"firebase/firestore\";import{getDownloadURL,ref,uploadString}from\"firebase/storage\";import{v4}from\"uuid\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faPlus,faTimes}from\"@fortawesome/free-solid-svg-icons\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var NweetFactory=function NweetFactory(_ref){var userObj=_ref.userObj;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),nweet=_useState2[0],setNweet=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),attachment=_useState4[0],setAttachment=_useState4[1];var fileInput=useRef();var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var attachmentURL,attachmentRef,uploadFile,docRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(nweet===\"\")){_context.next=2;break;}return _context.abrupt(\"return\");case 2:event.preventDefault();_context.prev=3;attachmentURL=\"\";if(!(attachment!==\"\")){_context.next=14;break;}// 파일 경로 참조 생성\nattachmentRef=ref(storageService,\"\".concat(userObj.uid,\"/\").concat(v4()));//v4: 랜덤숫자\n// storage 참조 경로로 파일 업로드\n_context.next=9;return uploadString(attachmentRef,attachment,\"data_url\");case 9:uploadFile=_context.sent;_context.next=12;return getDownloadURL(uploadFile.ref);case 12:attachmentURL=_context.sent;console.log(attachmentURL);case 14:_context.next=16;return addDoc(collection(dbService,\"nweets\"),{text:nweet,createdAt:Date.now(),creatorId:userObj.uid,attachmentURL:attachmentURL});case 16:docRef=_context.sent;setNweet(\"\");onClearAttachmentClick();_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](3);console.error(\"Error adding document: \",_context.t0);case 24:case\"end\":return _context.stop();}}},_callee,null,[[3,21]]);}));return function onSubmit(_x){return _ref2.apply(this,arguments);};}();var onChange=function onChange(event){var value=event.target.value;setNweet(value);};var onFileChange=function onFileChange(event){// 이미지 입력 시 url을 읽는 함수\nvar files=event.target.files;var theFile=files[0];var reader=new FileReader();reader.onloadend=function(finishEvent){var result=finishEvent.currentTarget.result;setAttachment(result);};reader.readAsDataURL(theFile);};var onClearAttachmentClick=function onClearAttachmentClick(){setAttachment(\"\");fileInput.current.value=\"\";};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,className:\"factoryForm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"factoryInput__container\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"FactoryInput_input\",value:nweet,onChange:onChange,type:\"text\",placeholder:\"What's on your mind?\",maxLength:120}),/*#__PURE__*/_jsx(\"input\",{className:\"factoryInput__arrow\",type:\"submit\",value:\"Nweet\"})]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"attach-file\",className:\"factoryInput_label\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Add photos\"}),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faPlus})]}),/*#__PURE__*/_jsx(\"input\",{id:\"attach-file\",style:{opacity:0},type:\"file\",accept:\"image/*\",onChange:onFileChange,ref:fileInput}),attachment&&/*#__PURE__*/_jsxs(\"div\",{className:\"factoryForm__attachment\",children:[/*#__PURE__*/_jsx(\"img\",{src:attachment,style:{backgroundImage:attachment}}),/*#__PURE__*/_jsxs(\"div\",{className:\"factoryForm__clear\",onClick:onClearAttachmentClick,children:[/*#__PURE__*/_jsx(\"span\",{children:\"Remove\"}),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTimes})]})]})]});};export default NweetFactory;","map":{"version":3,"sources":["C:/Users/gc159/Desktop/nwitter/src/components/NweetFactory.js"],"names":["React","useState","useRef","storageService","dbService","addDoc","collection","getDownloadURL","ref","uploadString","v4","FontAwesomeIcon","faPlus","faTimes","NweetFactory","userObj","nweet","setNweet","attachment","setAttachment","fileInput","onSubmit","event","preventDefault","attachmentURL","attachmentRef","uid","uploadFile","console","log","text","createdAt","Date","now","creatorId","docRef","onClearAttachmentClick","error","onChange","value","target","onFileChange","files","theFile","reader","FileReader","onloadend","finishEvent","result","currentTarget","readAsDataURL","current","opacity","backgroundImage"],"mappings":"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","sourcesContent":["import React, { useState, useRef } from \"react\";\r\nimport { storageService, dbService } from \"myFirebase\";\r\nimport { addDoc, collection } from \"firebase/firestore\";\r\nimport { getDownloadURL, ref, uploadString } from \"firebase/storage\"\r\nimport {v4} from \"uuid\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faPlus, faTimes } from \"@fortawesome/free-solid-svg-icons\";\r\n\r\nconst NweetFactory = ({ userObj }) => {\r\n    const [nweet, setNweet] = useState(\"\");\r\n    const [attachment, setAttachment] = useState(\"\");\r\n    const fileInput = useRef();\r\n    const onSubmit = async (event) => {\r\n        if (nweet === \"\") {\r\n            return;\r\n          }\r\n        event.preventDefault();\r\n        \r\n        try {\r\n            let attachmentURL = \"\";\r\n            if(attachment !== \"\"){\r\n                // 파일 경로 참조 생성\r\n                const attachmentRef = ref(storageService, `${userObj.uid}/${v4()}`);//v4: 랜덤숫자\r\n                // storage 참조 경로로 파일 업로드\r\n                const uploadFile = await uploadString(attachmentRef, attachment, \"data_url\");\r\n                // storage에 있는 파일 URL로 다운\r\n                attachmentURL = await getDownloadURL(uploadFile.ref)\r\n                console.log(attachmentURL);\r\n            }\r\n            const docRef = await addDoc(\r\n                collection(\r\n                    dbService, \"nweets\"), {\r\n                    text: nweet,\r\n                    createdAt: Date.now(),\r\n                    creatorId: userObj.uid,\r\n                    attachmentURL\r\n            });\r\n            setNweet(\"\");\r\n            onClearAttachmentClick();\r\n        } catch (error) {\r\n            console.error(\"Error adding document: \", error);\r\n        }\r\n    };\r\n    const onChange = (event) => {\r\n        const { target:{value} } = event;\r\n        setNweet(value);\r\n    }\r\n    const onFileChange = (event) => {\r\n        // 이미지 입력 시 url을 읽는 함수\r\n        const {target:{files}} = event;\r\n        const theFile = files[0];\r\n        const reader = new FileReader();\r\n        reader.onloadend = (finishEvent) => {\r\n            const {currentTarget: { result }} = finishEvent\r\n            setAttachment(result)\r\n        }\r\n        reader.readAsDataURL(theFile);\r\n    }\r\n    const onClearAttachmentClick = () => {\r\n        setAttachment(\"\")\r\n        fileInput.current.value = \"\";\r\n    };\r\n\r\n    return (\r\n        <form onSubmit={onSubmit}\r\n        className=\"factoryForm\">\r\n            <div className=\"factoryInput__container\">\r\n                <input className=\"FactoryInput_input\"\r\n                value={nweet} onChange={onChange} \r\n                type=\"text\" placeholder=\"What's on your mind?\" maxLength={120}/>\r\n                <input className=\"factoryInput__arrow\"\r\n                type=\"submit\" value=\"Nweet\" />\r\n                </div>\r\n                <label htmlFor=\"attach-file\" className=\"factoryInput_label\">\r\n                    <span>Add photos</span>\r\n                    <FontAwesomeIcon icon={faPlus} />\r\n                </label>\r\n                <input id=\"attach-file\" style={{opacity: 0}}\r\n                type=\"file\" accept=\"image/*\" onChange={onFileChange} ref={fileInput}/>\r\n                \r\n                \r\n                {attachment && (\r\n                    <div className=\"factoryForm__attachment\">\r\n                        <img src={attachment} style={{backgroundImage:attachment}} />\r\n                        <div className=\"factoryForm__clear\" onClick={onClearAttachmentClick}>\r\n                            <span>Remove</span>\r\n                            <FontAwesomeIcon icon={faTimes} />\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </form>\r\n    )\r\n}\r\nexport default NweetFactory"]},"metadata":{},"sourceType":"module"}